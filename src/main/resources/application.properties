# ===============================
# ? API Gateway Configuration
# ===============================
spring.application.name=apigateway-ms
server.port=${PORT:9090}

# ===============================
# ? Global CORS Configuration (Fixed)
# ===============================
# Deduplicate CORS headers if added multiple times
spring.cloud.gateway.server.webflux.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials

# Enable Global CORS Mapping
spring.cloud.gateway.server.webflux.globalcors.add-to-simple-url-handler-mapping=true

# Allow frontend from Vercel and local development
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowedOriginPatterns=https://*.vercel.app,http://localhost:3000
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowedMethods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowedHeaders=*
spring.cloud.gateway.server.webflux.globalcors.cors-configurations[/**].allowCredentials=true

# ===============================
# ? Microservice Routes
# ===============================
# Each service URL can be configured via environment variables for Render deployment

# Event Service
spring.cloud.gateway.server.webflux.routes[0].id=eventservice
spring.cloud.gateway.server.webflux.routes[0].uri=${EVENT_SERVICE_URL:http://localhost:7070}
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/events/**

# Admin Service
spring.cloud.gateway.server.webflux.routes[1].id=adminservice
spring.cloud.gateway.server.webflux.routes[1].uri=${ADMIN_SERVICE_URL:http://localhost:7002}
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/admins/**

# Food Service
spring.cloud.gateway.server.webflux.routes[2].id=foodservice
spring.cloud.gateway.server.webflux.routes[2].uri=${FOOD_SERVICE_URL:http://localhost:7000}
spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/foodOptions/**

# User Service
spring.cloud.gateway.server.webflux.routes[3].id=userservice
spring.cloud.gateway.server.webflux.routes[3].uri=${USER_SERVICE_URL:http://localhost:7001}
spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/users/**

# Payment Service
spring.cloud.gateway.server.webflux.routes[4].id=paymentservice
spring.cloud.gateway.server.webflux.routes[4].uri=${PAYMENT_SERVICE_URL:http://localhost:8080}
spring.cloud.gateway.server.webflux.routes[4].predicates[0]=Path=/payments/**

# Registration Service
spring.cloud.gateway.server.webflux.routes[5].id=registrationservice
spring.cloud.gateway.server.webflux.routes[5].uri=${REGISTRATION_SERVICE_URL:http://localhost:7003}
spring.cloud.gateway.server.webflux.routes[5].predicates[0]=Path=/registrations/**

# ===============================
# ? Logging (Optional)
# ===============================
logging.level.org.springframework.cloud.gateway=INFO
logging.level.com.fsd=DEBUG
